<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./css/styles.css">
    <link rel="shortcut icon" href="./resources/hammer-favicon.svg" type="image/x-icon">
    <title>El Herrajero</title>
</head>

<body>
    <div class="header">
        <div class="header-top">
            <div id="mySidepanel" class="side-panel">
                <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
                <a href="#">About</a>
                <a href="#">Services</a>
                <a href="#">Clients</a>
                <a href="#">Contact</a>
                <a href="admin.html">Admin - Crear Productos</a>
            </div>
            <div class="header-left">
                <button class="openbtn" onclick="openNav()">&#9776;</button>
                <div id="logotipo">
                    <h3>E<span id="dash-logo">|</span>H</h3>
                </div>
            </div>

            <div class="header-center">
                <div class="search-container">
                    <input type="search" placeholder="Buscar..." id="search-bar">
                    <button class="search-button"><img class="search-img" src="./resources/search.svg" alt="Buscar"></button>
                </div>
            </div>

            <!-- Parte derecha -->
            <div class="header-right">
                <a href="#"><img class="location-img" src="./resources/location.svg" alt="Ubicación"></a>
                <a href="#"><img class="cart-img" src="./resources/cart.svg" alt="Carrito"></a>
                <a href="./login.html"><img class="avatar-logo" src="./resources/user.svg" alt="Usuario"></a>
            </div>
        </div>
        
        <div class="enlaces">
            <ul>
                <li><a href="#">Promociones</a></li>
                <li><a href="#">Herramientas</a></li>
                <li><a href="#">Materiales</a></li>
                <li><a href="#">Servicios</a></li>
                <li><a href="#">Top Ventas</a></li>
            </ul>
        </div>
    </div>
    
    <section class="brands-container">
        <div class="carousel-track">
            <div class="brand"> <img src="./resources/yale.jpg" alt=""></div>
            <div class="brand"> <img src="./resources/foset.jpg" alt=""></div>
            <div class="brand"> <img src="./resources/rohm.jpg" alt=""></div>
            <div class="brand"> <img src="./resources/pintu.jpg" alt=""></div>
            <div class="brand"> <img src="./resources/cat.jpg" alt=""></div>
            <div class="brand"> <img src="./resources/3mm.jpg" alt=""></div>

            <div class="brand"> <img src="./resources/yale.jpg" alt=""></div>
            <div class="brand"> <img src="./resources/foset.jpg" alt=""></div>
            <div class="brand"> <img src="./resources/rohm.jpg" alt=""></div>
            <div class="brand"> <img src="./resources/pintu.jpg" alt=""></div>
            <div class="brand"> <img src="./resources/cat.jpg" alt=""></div>
            <div class="brand"> <img src="./resources/3mm.jpg" alt=""></div>
        </div>
    </section>

    <!-- AQUÍ ES DONDE CAMBIÉ: Ahora la sección está vacía y se llena con JavaScript -->
    <section class="products-container" id="products-container">
        <!-- Los productos se cargarán aquí dinámicamente desde la API -->
        <div class="loading" style="text-align: center; width: 100%; padding: 40px;">
            <p>Cargando productos...</p>
        </div>
    </section>

    <footer>
        <div>
            <h3>El Herrajero</h3>
        </div>
        <div>
            <h3>Atención al cliente</h3>
            <ul>
                <li><a href="">Ver tiendas</a></li>
                <li><a href="">Terminos y condiciones</a></li>
                <li><a href="">Reembolsos</a></li>
            </ul>
        </div>
        <div>
            <h3>Informate sobre</h3>
            <ul>
                <li><a href="">Informate sobre</a></li>
            </ul>
            <ul>
                <li><a href="">Contacta con nosotros</a></li>
            </ul>
            <ul>
                <li><a href="">Solicitud de Credito</a></li>
            </ul>
        </div>
        <div>
            <h3>Métodos de Pago</h3>
            <ul>
                <li>Visa</li>
                <li>Mastercard</li>
                <li>MercadoPay</li>
            </ul>
        </div>
    </footer>

    <script>

        const API_URL = 'http://localhost:5000';


        function openNav() {
            document.getElementById("mySidepanel").style.width = "250px";
        }

        function closeNav() {
            document.getElementById("mySidepanel").style.width = "0";
        }

        async function loadProducts() {
            const container = document.getElementById('products-container');
            
            try {
                const response = await fetch(`${API_URL}/products`);
                if (!response.ok) {
                    throw new Error('Error al cargar productos');
                }
                const products = await response.json();
                displayProducts(products);
            } catch (error) {
                console.error('Error:', error);
                // Si hay error, mostrar mensaje
                container.innerHTML = `
                    <div style="text-align: center; width: 100%; padding: 40px;">
                        <h3>Error al cargar productos</h3>
                        <p>Asegúrate de que la API esté ejecutándose en localhost:5000</p>
                        <button onclick="loadProducts()" style="padding: 10px 20px; background: #4CAF50; color: white; border: none; border-radius: 5px; cursor: pointer;">
                            Reintentar
                        </button>
                    </div>
                `;
            }
        }
        function displayProducts(products) {
            const container = document.getElementById('products-container');
            if (products.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; width: 100%; padding: 40px;">
                        <h3>No hay productos disponibles</h3>
                        <p><a href="admin.html" style="color: #4CAF50;">Crear el primer producto</a></p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = '';
            products.forEach(product => {
                const productCard = document.createElement('div');
                productCard.className = 'product-card';
                
                productCard.innerHTML = `
                    <img class="product-img" src="${product.image}" alt="${product.name}" onerror="this.src='./resources/product.jpg'">
                    <p class="product-name">${product.name}</p>
                    <p class="product-price">${formatPrice(product.price)} COP</p>
                    <input class="product-button" type="button" value="Comprar" onclick="buyProduct(${product.id})">
                `;
                
                container.appendChild(productCard);
            });
        }
        function formatPrice(price) {
            return new Intl.NumberFormat('es-CO').format(price);
        }
        function buyProduct(productId) {
            alert(`Producto ${productId} agregado al carrito`);
        }
        document.addEventListener('DOMContentLoaded', function() {
            loadProducts();
        });
    </script>
</body>

</html>